<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>sxyzOIç½‘ - è®¨è®ºåŒº</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #475569;
      --light: #f8fafc;
      --dark: #0f172a;
      --success: #10b981;
      --error: #ef4444;
      --gray: #94a3b8;
      --gray-light: #e2e8f0;
      --card-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: #f0f2f5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* å¯¼èˆªæ  */
    .navbar {
      background-color: var(--dark);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .navbar-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      text-decoration: none;
      margin-left: 1rem;
    }
    
    .logo span {
      color: var(--primary);
    }
    
    /* ç™»å½•ç”¨æˆ·ä¿¡æ¯ */
    .user-info {
      position: absolute;
      top: 50%;
      left: 2rem;
      transform: translateY(-50%);
      color: white;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    
    .user-info .user-role {
      font-size: 0.8rem;
      background-color: var(--primary);
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
    }
    
    .logout-btn {
      background-color: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background-color: rgba(255,255,255,0.1);
    }
    
    .nav-links {
      display: flex;
      gap: 2rem;
      margin-left: auto;
      padding-right: 1rem;
    }
    
    .nav-links a {
      color: white;
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .nav-links a:hover, .nav-links a.active {
      color: var(--primary);
      font-weight: 500;
    }
    
    /* å¸–å­åŒºæ ·å¼ */
    .forum-section {
      flex: 1;
      padding: 3rem 0;
    }
    
    .forum-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .forum-title {
      font-size: 2rem;
      color: var(--dark);
      font-weight: 600;
    }
    
    .btn {
      display: inline-block;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      font-size: 1rem;
      text-decoration: none;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
    }
    
    /* å¸–å­åˆ—è¡¨ */
    .post-list {
      display: grid;
      gap: 1.5rem;
    }
    
    .post-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    
    .post-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .post-title {
      font-size: 1.4rem;
      color: var(--dark);
      margin: 0;
    }
    
    .post-title a {
      color: var(--dark);
      text-decoration: none;
      transition: color 0.3s;
    }
    
    .post-title a:hover {
      color: var(--primary);
    }
    
    .post-meta {
      display: flex;
      gap: 1.5rem;
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .post-content {
      color: var(--secondary);
      margin-bottom: 1rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .post-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .post-author {
      font-weight: 500;
      color: var(--primary);
    }
    
    .post-stats {
      display: flex;
      gap: 1.5rem;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    /* å¸–å­æ“ä½œæŒ‰é’®ï¼ˆç®¡ç†å‘˜å¯è§ï¼‰ */
    .post-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .post-btn {
      padding: 0.3rem 0.8rem;
      font-size: 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
    }
    
    .edit-btn {
      background-color: #f0f9ff;
      color: var(--primary);
    }
    
    .delete-btn {
      background-color: #fee2e2;
      color: var(--error);
    }
    
    /* å¸–å­è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆé»˜è®¤éšè—ï¼‰ */
    .modal {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    
    .modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 2rem;
      transform: translateY(-20px);
      transition: transform 0.3s;
    }
    
    .modal.active .modal-content {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .modal-title {
      font-size: 1.8rem;
      color: var(--dark);
      margin: 0;
    }
    
    .close-modal {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
      transition: color 0.3s;
    }
    
    .close-modal:hover {
      color: var(--error);
    }
    
    .modal-body {
      color: var(--secondary);
      line-height: 1.8;
      margin-bottom: 2rem;
    }
    
    .modal-footer {
      padding-top: 1rem;
      border-top: 1px solid var(--gray-light);
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    /* å‘å¸ƒ/ç¼–è¾‘å¸–å­è¡¨å•ï¼ˆé»˜è®¤éšè—ï¼‰ */
    .post-form-modal {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    
    .post-form-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .form-content {
      background-color: white;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      padding: 2rem;
      transform: translateY(-20px);
      transition: transform 0.3s;
    }
    
    .post-form-modal.active .form-content {
      transform: translateY(0);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--secondary);
    }
    
    .form-control {
      width: 100%;
      padding: 0.9rem 1.2rem;
      border: 1px solid var(--gray-light);
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
    }
    
    textarea.form-control {
      min-height: 200px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 2rem;
    }
    
    .btn-cancel {
      background-color: var(--gray-light);
      color: var(--secondary);
    }
    
    .btn-cancel:hover {
      background-color: var(--gray);
      color: white;
    }
    
    /* æ— å¸–å­æç¤º */
    .no-posts {
      text-align: center;
      padding: 4rem 2rem;
      background-color: white;
      border-radius: 12px;
      box-shadow: var(--card-shadow);
      color: var(--gray);
    }
    
    .no-posts h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--secondary);
    }
    
    /* é¡µè„š */
    .footer {
      background-color: var(--dark);
      color: white;
      padding: 1.5rem 0;
      text-align: center;
      margin-top: auto;
    }
    
    .footer p {
      opacity: 0.8;
      font-size: 0.9rem;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .navbar-container {
        flex-direction: column;
        gap: 1rem;
        position: relative;
      }
      
      .user-info {
        position: relative;
        top: 0;
        left: 0;
        transform: none;
        margin-bottom: 1rem;
      }
      
      .nav-links {
        margin-left: 0;
        width: 100%;
        justify-content: center;
        padding-right: 0;
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .forum-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .post-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .modal-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="navbar-container container">
      <!-- ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆé»˜è®¤éšè—ï¼Œç™»å½•åæ˜¾ç¤ºï¼‰ -->
      <div id="userInfo" class="user-info" style="display: none;">
        <span id="usernameDisplay"></span>
        <span id="userRole" class="user-role"></span>
        <button id="logoutBtn" class="logout-btn">é€€å‡ºç™»å½•</button>
      </div>
      
      <a href="index.html" class="logo">sxyz<span>OI</span>ç½‘</a>
      <div class="nav-links">
        <a href="index.html">é¦–é¡µ</a>
        <a href="index.html#about">å…³äº</a>
        <a href="forum.html" class="active">è®¨è®ºåŒº</a>
        <a href="login.html" id="loginLink">ç™»å½•</a>
        <a href="https://www.sxdyzx.com.cn/">å­¦æ ¡å®˜ç½‘</a>
      </div>
    </div>
  </nav>

  <!-- å¸–å­åŒº -->
  <section class="forum-section">
    <div class="container">
      <div class="forum-header">
        <h1 class="forum-title">OIè®¨è®ºåŒº</h1>
        <!-- ç®¡ç†å‘˜å¯è§ï¼šå‘å¸ƒå¸–å­æŒ‰é’® -->
        <button id="createPostBtn" class="btn btn-primary" style="display: none;">å‘å¸ƒæ–°å¸–å­</button>
      </div>
      
      <!-- å¸–å­åˆ—è¡¨ï¼ˆåŠ¨æ€æ¸²æŸ“ï¼‰ -->
      <div class="post-list" id="postList">
        <!-- å¸–å­å°†é€šè¿‡JSä»localStorageåŠ¨æ€åŠ è½½ -->
      </div>
      
      <!-- æ— å¸–å­æç¤º -->
      <div id="noPosts" class="no-posts" style="display: none;">
        <h3>æš‚æ— å¸–å­</h3>
        <p>å¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªå¸–å­ï¼Œå¼€å¯è®¨è®ºå§ï½</p>
      </div>
    </div>
  </section>

  <!-- å¸–å­è¯¦æƒ…æ¨¡æ€æ¡† -->
  <div class="modal" id="postDetailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalPostTitle"></h2>
        <button class="close-modal" id="closeDetailModal">&times;</button>
      </div>
      <div class="modal-body" id="modalPostContent"></div>
      <div class="modal-footer" id="modalPostFooter"></div>
    </div>
  </div>

  <!-- å‘å¸ƒ/ç¼–è¾‘å¸–å­è¡¨å•æ¨¡æ€æ¡† -->
  <div class="post-form-modal" id="postFormModal">
    <div class="form-content">
      <h2 id="formTitle">å‘å¸ƒæ–°å¸–å­</h2>
      <form id="postForm">
        <input type="hidden" id="editPostId"> <!-- ç¼–è¾‘æ—¶å­˜å‚¨å¸–å­ID -->
        <div class="form-group">
          <label for="postTitle">å¸–å­æ ‡é¢˜</label>
          <input type="text" id="postTitle" class="form-control" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜" required>
        </div>
        <div class="form-group">
          <label for="postCategory">åˆ†ç±»</label>
          <input type="text" id="postCategory" class="form-control" placeholder="ä¾‹å¦‚ï¼šç®—æ³•å…¥é—¨ã€æ¯”èµ›ç»éªŒ" required>
        </div>
        <div class="form-group">
          <label for="postContent">å¸–å­å†…å®¹</label>
          <textarea id="postContent" class="form-control" placeholder="è¯·è¾“å…¥å¸–å­è¯¦ç»†å†…å®¹" required></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-cancel" id="cancelPost">å–æ¶ˆ</button>
          <button type="submit" class="btn btn-primary">å‘å¸ƒ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="container">
      <p>Â© 2025 sxyzOIç½‘ - sxyzOIç½‘</p>
      <p style="margin-top: 0.5rem; opacity: 0.6;">ç½‘ç«™å»ºè®¾ä¸­ï¼Œæ•¬è¯·æœŸå¾…æ›´å¤šåŠŸèƒ½...</p>
    </div>
  </footer>

  <script>
    // ====================== æœ¬åœ°å­˜å‚¨å·¥å…· ======================
    const StorageTool = {
      // è·å–å¸–å­åˆ—è¡¨
      getPosts() {
        const posts = localStorage.getItem('sxyzoi_posts');
        return posts ? JSON.parse(posts) : [
          // åˆå§‹åŒ–é»˜è®¤å¸–å­ï¼ˆé¦–æ¬¡æ‰“å¼€æ—¶æ˜¾ç¤ºï¼‰
          {
            id: 1,
            title: "å¦‚ä½•å…¥é—¨ç®—æ³•ç«èµ›ï¼Ÿåˆ†äº«æˆ‘çš„å­¦ä¹ è·¯çº¿",
            category: "ç®—æ³•å…¥é—¨",
            content: "ä½œä¸ºä¸€ååˆšå…¥é—¨OIåŠå¹´çš„è’Ÿè’»ï¼Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„å­¦ä¹ è·¯çº¿ï¼š\n1. è¯­æ³•åŸºç¡€ï¼šå…ˆæŒæ¡C++æ ¸å¿ƒè¯­æ³•ï¼ˆå¾ªç¯ã€æ¡ä»¶ã€å‡½æ•°ã€æ•°ç»„ã€æŒ‡é’ˆç­‰ï¼‰\n2. æ•°æ®ç»“æ„ï¼šå­¦ä¹ é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€äºŒå‰æ ‘ã€å›¾ã€å“ˆå¸Œè¡¨ç­‰åŸºç¡€ç»“æ„\n3. ç®—æ³•æ¨¡æ¿ï¼šèƒŒè¯µå¹¶ç†è§£å¸¸ç”¨ç®—æ³•ï¼ˆæ’åºã€äºŒåˆ†ã€BFS/DFSã€åŠ¨æ€è§„åˆ’ç­‰ï¼‰\n4. åˆ·é¢˜å¹³å°ï¼šæ´›è°·ã€Codeforcesã€AcWingç­‰ï¼Œä»ç®€å•é¢˜å¼€å§‹é€æ­¥æå‡\n\næœ‰æ²¡æœ‰å¤§ä½¬èƒ½æŒ‡ç‚¹ä¸€ä¸‹åç»­è¯¥é‡ç‚¹çªç ´å“ªäº›ç®—æ³•ï¼Ÿæˆ–è€…æ¨èä¸€äº›å¥½çš„å­¦ä¹ èµ„æºï¼Ÿ",
            author: "onE4_10",
            createTime: "2025-01-10",
            viewCount: 32,
            commentCount: 5
          },
          {
            id: 2,
            title: "æ´›è°·P1001é¢˜è§£ï¼ˆæ–°æ‰‹å‘ï¼‰",
            category: "é¢˜è§£åˆ†äº«",
            content: "æ´›è°·P1001æ˜¯å…¥é—¨å¿…åšé¢˜ï¼Œé¢˜ç›®è¦æ±‚è®¡ç®—a+bçš„å€¼ï¼Œçœ‹ä¼¼ç®€å•ä½†æœ‰ä¸€äº›å‘ç‚¹ï¼š\n1. è¾“å…¥å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œéœ€è¦æ³¨æ„ç¬¦å·å¤„ç†\n2. æ•°æ®èŒƒå›´å¯èƒ½è¾ƒå¤§ï¼Œå»ºè®®ç”¨long longç±»å‹\n3. è¾“å…¥è¾“å‡ºæ ¼å¼è¦ä¸¥æ ¼æŒ‰ç…§é¢˜ç›®è¦æ±‚\n\nä»£ç ç¤ºä¾‹ï¼š\n#include <iostream>\nusing namespace std;\nint main() {\n    long long a, b;\n    cin >> a >> b;\n    cout << a + b << endl;\n    return 0;\n}\n\næ–°æ‰‹å¦‚æœæœ‰ç–‘é—®å¯ä»¥åœ¨è¯„è®ºåŒºäº¤æµï½",
            author: "guest",
            createTime: "2025-01-12",
            viewCount: 45,
            commentCount: 3
          }
        ];
      },

      // ä¿å­˜å¸–å­åˆ—è¡¨
      savePosts(posts) {
        localStorage.setItem('sxyzoi_posts', JSON.stringify(posts));
      },

      // æ·»åŠ æ–°å¸–å­
      addPost(post) {
        const posts = this.getPosts();
        const newId = posts.length > 0 ? Math.max(...posts.map(p => p.id)) + 1 : 1;
        const newPost = {
          id: newId,
          ...post,
          viewCount: 0,
          commentCount: 0,
          createTime: new Date().toLocaleDateString()
        };
        posts.unshift(newPost); // æ–°å¢å¸–å­æ’åœ¨æœ€å‰é¢
        this.savePosts(posts);
        return newPost;
      },

      // æ›´æ–°å¸–å­
      updatePost(id, updatedPost) {
        const posts = this.getPosts();
        const index = posts.findIndex(p => p.id === id);
        if (index !== -1) {
          posts[index] = { ...posts[index], ...updatedPost };
          this.savePosts(posts);
          return posts[index];
        }
        return null;
      },

      // åˆ é™¤å¸–å­
      deletePost(id) {
        let posts = this.getPosts();
        posts = posts.filter(p => p.id !== id);
        this.savePosts(posts);
        return posts;
      },

      // æ ¹æ®IDè·å–å¸–å­
      getPostById(id) {
        const posts = this.getPosts();
        return posts.find(p => p.id === id) || null;
      },

      // å¢åŠ å¸–å­æµè§ˆé‡
      increaseViewCount(id) {
        const posts = this.getPosts();
        const index = posts.findIndex(p => p.id === id);
        if (index !== -1) {
          posts[index].viewCount++;
          this.savePosts(posts);
        }
      }
    };

    // ====================== é¡µé¢åˆå§‹åŒ– ======================
    let loginUser = JSON.parse(localStorage.getItem('loginUser')); // å½“å‰ç™»å½•ç”¨æˆ·
    const postListEl = document.getElementById('postList');
    const noPostsEl = document.getElementById('noPosts');
    const createPostBtn = document.getElementById('createPostBtn');
    const postFormModal = document.getElementById('postFormModal');
    const postDetailModal = document.getElementById('postDetailModal');
    const postForm = document.getElementById('postForm');

    // åˆå§‹åŒ–é¡µé¢çŠ¶æ€
    window.onload = function() {
      // åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€ï¼ˆæ˜¾ç¤º/éšè—ç™»å½•ä¿¡æ¯ã€å‘å¸ƒæŒ‰é’®ï¼‰
      initUserStatus();
      // æ¸²æŸ“å¸–å­åˆ—è¡¨
      renderPostList();
      // ç»‘å®šäº‹ä»¶ç›‘å¬
      bindEvents();
    };

    // ====================== åŠŸèƒ½å‡½æ•° ======================
    // åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
    function initUserStatus() {
      const userInfo = document.getElementById('userInfo');
      const usernameDisplay = document.getElementById('usernameDisplay');
      const userRole = document.getElementById('userRole');
      const loginLink = document.getElementById('loginLink');
      const logoutBtn = document.getElementById('logoutBtn');

      if (loginUser) {
        // å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œéšè—ç™»å½•é“¾æ¥
        userInfo.style.display = 'flex';
        usernameDisplay.textContent = `æ¬¢è¿ï¼Œ${loginUser.username}`;
        userRole.textContent = loginUser.role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ¸¸å®¢';
        loginLink.style.display = 'none';

        // ç®¡ç†å‘˜æ˜¾ç¤ºå‘å¸ƒå¸–å­æŒ‰é’®
        if (loginUser.role === 'admin') {
          createPostBtn.style.display = 'block';
        }

        // é€€å‡ºç™»å½•
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('loginUser');
          window.location.reload();
        });
      } else {
        // æœªç™»å½•ï¼šéšè—ç”¨æˆ·ä¿¡æ¯ï¼Œæ˜¾ç¤ºç™»å½•é“¾æ¥
        userInfo.style.display = 'none';
        loginLink.style.display = 'block';
        createPostBtn.style.display = 'none';
      }
    }

    // æ¸²æŸ“å¸–å­åˆ—è¡¨
    function renderPostList() {
      const posts = StorageTool.getPosts();
      
      // æ˜¾ç¤ºæ— å¸–å­æç¤ºæˆ–å¸–å­åˆ—è¡¨
      if (posts.length === 0) {
        postListEl.style.display = 'none';
        noPostsEl.style.display = 'block';
        return;
      }

      postListEl.style.display = 'grid';
      noPostsEl.style.display = 'none';

      // æ¸…ç©ºç°æœ‰åˆ—è¡¨
      postListEl.innerHTML = '';

      // æ¸²æŸ“æ¯ä¸ªå¸–å­
      posts.forEach(post => {
        const postCard = document.createElement('div');
        postCard.className = 'post-card';
        postCard.dataset.postId = post.id;

        // å¸–å­æ“ä½œæŒ‰é’®ï¼ˆä»…ç®¡ç†å‘˜æˆ–å¸–å­ä½œè€…å¯è§ï¼‰
        const actionBtns = loginUser && (loginUser.role === 'admin' || loginUser.username === post.author) 
          ? `
            <div class="post-actions">
              <button class="post-btn edit-btn" data-id="${post.id}">ç¼–è¾‘</button>
              <button class="post-btn delete-btn" data-id="${post.id}">åˆ é™¤</button>
            </div>
          `
          : '';

        postCard.innerHTML = `
          <div class="post-header">
            <h2 class="post-title"><a href="javascript:;" class="post-link" data-id="${post.id}">${post.title}</a></h2>
            <div class="post-meta">
              <span>${post.createTime}</span>
              <span>${post.category}</span>
            </div>
          </div>
          <div class="post-content">${post.content.replace(/\n/g, '<br>')}</div>
          <div class="post-footer">
            <span>ä½œè€…ï¼š<span class="post-author">${post.author}</span></span>
            <div class="post-stats">
              <div class="stat-item">ğŸ‘ï¸ ${post.viewCount}</div>
              <div class="stat-item">ğŸ’¬ ${post.commentCount}</div>
            </div>
            ${actionBtns}
          </div>
        `;

        postListEl.appendChild(postCard);
      });
    }

    // æ˜¾ç¤ºå¸–å­è¯¦æƒ…
    function showPostDetail(id) {
      const post = StorageTool.getPostById(id);
      if (!post) return;

      // å¢åŠ æµè§ˆé‡
      StorageTool.increaseViewCount(id);

      // å¡«å……æ¨¡æ€æ¡†å†…å®¹
      document.getElementById('modalPostTitle').textContent = post.title;
      document.getElementById('modalPostContent').innerHTML = post.content.replace(/\n/g, '<br>');
      document.getElementById('modalPostFooter').innerHTML = `
        ä½œè€…ï¼š<span class="post-author">${post.author}</span> | 
        å‘å¸ƒæ—¶é—´ï¼š${post.createTime} | 
        æµè§ˆï¼š${post.viewCount + 1} æ¬¡ | 
        è¯„è®ºï¼š${post.commentCount} æ¡
      `;

      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      postDetailModal.classList.add('active');
    }

    // æ‰“å¼€å‘å¸ƒ/ç¼–è¾‘å¸–å­è¡¨å•
    function openPostForm(postId = null) {
      const formTitle = document.getElementById('formTitle');
      const editPostId = document.getElementById('editPostId');
      const postTitleInput = document.getElementById('postTitle');
      const postCategoryInput = document.getElementById('postCategory');
      const postContentInput = document.getElementById('postContent');

      if (postId) {
        // ç¼–è¾‘æ¨¡å¼ï¼šå¡«å……ç°æœ‰å¸–å­å†…å®¹
        const post = StorageTool.getPostById(postId);
        if (!post) return;

        formTitle.textContent = 'ç¼–è¾‘å¸–å­';
        editPostId.value = postId;
        postTitleInput.value = post.title;
        postCategoryInput.value = post.category;
        postContentInput.value = post.content;
      } else {
        // å‘å¸ƒæ¨¡å¼ï¼šæ¸…ç©ºè¡¨å•
        formTitle.textContent = 'å‘å¸ƒæ–°å¸–å­';
        editPostId.value = '';
        postTitleInput.value = '';
        postCategoryInput.value = '';
        postContentInput.value = '';
      }

      // æ˜¾ç¤ºè¡¨å•æ¨¡æ€æ¡†
      postFormModal.classList.add('active');
    }

    // ====================== äº‹ä»¶ç»‘å®š ======================
    function bindEvents() {
      // å‘å¸ƒå¸–å­æŒ‰é’®ç‚¹å‡»
      createPostBtn.addEventListener('click', () => openPostForm());

      // å–æ¶ˆå‘å¸ƒ/ç¼–è¾‘
      document.getElementById('cancelPost').addEventListener('click', () => {
        postFormModal.classList.remove('active');
      });

      // å…³é—­å¸–å­è¯¦æƒ…
      document.getElementById('closeDetailModal').addEventListener('click', () => {
        postDetailModal.classList.remove('active');
      });

      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      postDetailModal.addEventListener('click', (e) => {
        if (e.target === postDetailModal) postDetailModal.classList.remove('active');
      });
      postFormModal.addEventListener('click', (e) => {
        if (e.target === postFormModal) postFormModal.classList.remove('active');
      });

      // å¸–å­è¡¨å•æäº¤ï¼ˆå‘å¸ƒ/ç¼–è¾‘ï¼‰
      postForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const editPostId = document.getElementById('editPostId').value;
        const postData = {
          title: document.getElementById('postTitle').value.trim(),
          category: document.getElementById('postCategory').value.trim(),
          content: document.getElementById('postContent').value.trim(),
          author: loginUser.username // ä½œè€…ä¸ºå½“å‰ç™»å½•ç”¨æˆ·
        };

        if (editPostId) {
          // ç¼–è¾‘å¸–å­
          StorageTool.updatePost(Number(editPostId), postData);
          alert('âœ… å¸–å­ç¼–è¾‘æˆåŠŸï¼');
        } else {
          // å‘å¸ƒæ–°å¸–å­
          StorageTool.addPost(postData);
          alert('âœ… å¸–å­å‘å¸ƒæˆåŠŸï¼');
        }

        // å…³é—­æ¨¡æ€æ¡†ï¼Œé‡æ–°æ¸²æŸ“åˆ—è¡¨
        postFormModal.classList.remove('active');
        renderPostList();
      });

      // å¸–å­åˆ—è¡¨ç‚¹å‡»äº‹ä»¶ï¼ˆæŸ¥çœ‹è¯¦æƒ…ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
      postListEl.addEventListener('click', (e) => {
        const postLink = e.target.closest('.post-link');
        const editBtn = e.target.closest('.edit-btn');
        const deleteBtn = e.target.closest('.delete-btn');

        if (postLink) {
          // æŸ¥çœ‹å¸–å­è¯¦æƒ…
          const postId = Number(postLink.dataset.id);
          showPostDetail(postId);
        } else if (editBtn) {
          // ç¼–è¾‘å¸–å­ï¼ˆéœ€ç™»å½•ï¼‰
          if (!loginUser) {
            alert('âŒ è¯·å…ˆç™»å½•åå†ç¼–è¾‘å¸–å­ï¼');
            window.location.href = 'login.html';
            return;
          }
          const postId = Number(editBtn.dataset.id);
          openPostForm(postId);
        } else if (deleteBtn) {
          // åˆ é™¤å¸–å­ï¼ˆéœ€ç™»å½•ï¼‰
          if (!loginUser) {
            alert('âŒ è¯·å…ˆç™»å½•åå†åˆ é™¤å¸–å­ï¼');
            window.location.href = 'login.html';
            return;
          }

          if (confirm('âš ï¸ ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¸–å­å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼')) {
            const postId = Number(deleteBtn.dataset.id);
            StorageTool.deletePost(postId);
            renderPostList();
            alert('âœ… å¸–å­åˆ é™¤æˆåŠŸï¼');
          }
        }
      });
    }
  </script>
</body>
</html>
